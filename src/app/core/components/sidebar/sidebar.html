<aside class="sidebar" role="navigation" aria-label="Menú lateral"
       [class.collapsed]="isCollapsed"
       [@sidebarState]="isCollapsed ? 'closed' : 'open'">

  <div class="sidebar-header">
    <h2 *ngIf="!isCollapsed" class="brand">Fysen</h2>
    <button class="toggle-btn" aria-label="Alternar barra lateral" (click)="toggle.emit()">☰</button>
  </div>

  <nav>
    <ul class="menu-list">
      <ng-container *ngFor="let item of menuItems">
        <li class="menu-item" *ngIf="canShow(item)">
          <!-- Submenú -->
          <ng-container *ngIf="item.children && item.children.length; else singleLink">
            <button class="menu-btn"
                    (click)="toggleSubmenu(item.label)"
                    [attr.aria-expanded]="openSubmenu === item.label">
              <i *ngIf="item.icon" class="{{ item.icon }}"></i>
              <span class="label" *ngIf="!isCollapsed">{{ item.label }}</span>
              <span class="spacer"></span>
              <span class="badge" *ngIf="item.badge">{{ item.badge.text }}</span>
            </button>

            <ul class="submenu" [@submenu]="openSubmenu === item.label ? 'open' : 'closed'">
              <li *ngFor="let child of item.children">
                <a class="submenu-link" [routerLink]="child.route" routerLinkActive="active">
                  <i *ngIf="child.icon" class="{{ child.icon }}"></i>
                  <span>{{ child.label }}</span>
                </a>
              </li>
            </ul>
          </ng-container>

          <!-- Sin submenú -->
          <ng-template #singleLink>
            <a *ngIf="!item.external" class="menu-link" [routerLink]="item.route" routerLinkActive="active">
              <i *ngIf="item.icon" class="{{ item.icon }}"></i>
              <span *ngIf="!isCollapsed">{{ item.label }}</span>
            </a>
            <a *ngIf="item.external" class="menu-link" [href]="item.route" target="_blank">
              <i *ngIf="item.icon" class="{{ item.icon }}"></i>
              <span *ngIf="!isCollapsed">{{ item.label }}</span>
            </a>
          </ng-template>
        </li>
      </ng-container>
    </ul>
  </nav>
</aside>
